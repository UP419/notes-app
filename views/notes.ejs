<%- include('partials/header'); -%>

<h2>Here are notes</h2>
<input type="text" name="note" required/>
<button id="newNoteButton"> Add Note</button>
<button id="allNotesButton">Get All Notes</button>
<button id="myNotesButton">My Notes</button>
<ul id="notes-list">
</ul>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const res = await fetch('/getNotesByUser', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      const data = await res.json();

      const notesList = document.getElementById('notes-list');
      data.forEach(note => {
        const listItem = document.createElement('li');
        listItem.textContent = note.note;
        notesList.appendChild(listItem);
      });
    } catch (err) {
      console.error('Error fetching notes:', err);
    }

    const newNoteButton = document.getElementById('newNoteButton');
    newNoteButton.addEventListener('click', async () => {
      const noteInput = document.querySelector('input[name="note"]');
      const newNote = noteInput.value.trim();
      if (newNote) {
        try {
          const res = await fetch('/addNote', {
            method: 'POST',
            body: JSON.stringify({ note: newNote }),
            headers: {
              'Content-Type': 'application/json'
            }
          });
          const data = await res.json();
          const notesList = document.getElementById('notes-list');
          const listItem = document.createElement('li');
          listItem.textContent = newNote;
          notesList.appendChild(listItem);
          noteInput.value = '';
        } catch (err) {
          console.error('Error adding note:', err);
        }
      }
    });

    const allNotesButton = document.getElementById('allNotesButton');
    allNotesButton.addEventListener('click', async () => {
      try {
        const res = await fetch('/getAllNotes', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        const data = await res.json();

        const notesList = document.getElementById('notes-list');

        while (notesList.firstChild) {
          notesList.removeChild(notesList.firstChild);
        }

        data.forEach(note => {
          const listItem = document.createElement('li');
          listItem.textContent = note.note;
          notesList.appendChild(listItem);
        });
      } catch (err) {
        console.error('Error fetching notes:', err);
      }
    });

    const myNotesButton = document.getElementById('myNotesButton');
    myNotesButton.addEventListener('click', async () => {
      try {
        const res = await fetch('/getNotesByUser', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        const data = await res.json();

        const notesList = document.getElementById('notes-list');

        while (notesList.firstChild) {
          notesList.removeChild(notesList.firstChild);
        }

        data.forEach(note => {
          const listItem = document.createElement('li');
          listItem.textContent = note.note;
          notesList.appendChild(listItem);
        });
      } catch (err) {
        console.error('Error fetching notes:', err);
      }
    });

  });
</script>
